#!/bin/bash

# =============================================================================
# Code Sync Script - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–¥–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
# =============================================================================

PROJECT_PATH="/var/www/estimate-app"
LOCAL_PATH="."

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è backend –∫–æ–¥–∞
echo "üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è backend –∫–æ–¥–∞..."
rsync -avz --exclude='*.pyc' --exclude='__pycache__' \
    ./backend/ root@195.14.122.135:$PROJECT_PATH/backend-live/

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Django –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
ssh root@195.14.122.135 "docker exec estimate-backend kill -HUP 1"

echo "‚úÖ Backend –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω"

# –î–ª—è frontend –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
echo "‚ÑπÔ∏è –î–ª—è frontend –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π"