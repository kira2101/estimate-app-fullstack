# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions Secrets –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

## –¢—Ä–µ–±—É–µ–º—ã–µ Secrets –¥–ª—è Dev –¥–µ–ø–ª–æ—è

–î–ª—è —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –≤ dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ secrets –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

### üîë SSH –î–æ—Å—Ç—É–ø

#### `DEV_SSH_PRIVATE_KEY`
```
–ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É 195.14.122.135
–§–æ—Ä–º–∞—Ç: RSA –∏–ª–∏ Ed25519 private key
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å:**
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SSH –∫–ª—é—á (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω):
   ```bash
   ssh-keygen -t ed25519 -C "github-actions-dev-deploy"
   ```

2. –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   ssh-copy-id -i ~/.ssh/id_ed25519.pub ubuntu@195.14.122.135
   ```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:
   ```bash
   cat ~/.ssh/id_ed25519
   ```

### üåê –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### `SERVER_HOST` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —É–∂–µ –≤ env)
```
195.14.122.135
```

#### `SERVER_USER` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —É–∂–µ –≤ workflow)
```
ubuntu
```

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

#### `DEV_DATABASE_URL`
```
postgresql://estimate_user:secure_password_123@localhost:5432/estimate_app_db
```

#### `DEV_SECRET_KEY`
```
django-insecure-dev-key-only-for-development-do-not-use-in-production
```

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ GitHub Secrets

### –®–∞–≥ 1: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ secrets
1. –ù–∞–∂–º–∏—Ç–µ **"New repository secret"**
2. –î–æ–±–∞–≤—å—Ç–µ –∫–∞–∂–¥—ã–π secret –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–º

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GitHub Actions –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ secrets:
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ‚Üí **Actions** ‚Üí **General**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ **"Allow GitHub Actions to create and approve pull requests"** –≤–∫–ª—é—á–µ–Ω–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ 195.14.122.135:

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ubuntu** (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):
   ```bash
   sudo adduser ubuntu
   sudo usermod -aG sudo ubuntu
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –¥–æ—Å—Ç—É–ø –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ubuntu**:
   ```bash
   sudo su - ubuntu
   mkdir -p ~/.ssh
   chmod 700 ~/.ssh
   ```

3. **–î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á**:
   ```bash
   echo "–≤–∞—à_–ø—É–±–ª–∏—á–Ω—ã–π_–∫–ª—é—á" >> ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è** (–¥–ª—è –¥–µ–ø–ª–æ—è):
   ```bash
   sudo visudo
   # –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
   ubuntu ALL=(ALL) NOPASSWD: /usr/bin/nginx, /usr/bin/pkill, /usr/bin/systemctl
   ```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º GitHub Actions –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

```bash
# –° –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
ssh -i ~/.ssh/id_ed25519 ubuntu@195.14.122.135

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–µ–∫—Ç—É
cd /var/www/estimate-app-dev
sudo -n nginx -t  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –ø–∞—Ä–æ–ª—è
```

## üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
–î–µ–ø–ª–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ push –≤ –≤–µ—Ç–∫—É `dev`:
```bash
git push origin dev
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub ‚Üí **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow **"üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π Dev –æ–∫—Ä—É–∂–µ–Ω–∏—è"**
3. –ù–∞–∂–º–∏—Ç–µ **"Run workflow"**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É `dev`
5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–º–µ—Ç—å—Ç–µ **"–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π"**

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ GitHub Actions
1. GitHub ‚Üí **Actions** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫
2. –†–∞—Å–∫—Ä–æ–π—Ç–µ –∫–∞–∂–¥—ã–π —à–∞–≥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ssh ubuntu@195.14.122.135 "ps aux | grep gunicorn"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
ssh ubuntu@195.14.122.135 "tail -f /var/www/estimate-app-dev/logs/gunicorn.log"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl -s https://dev.app.iqbs.pro/api/v1/health/
```

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: SSH connection failed
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ secrets
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º SSH (600 –¥–ª—è –∫–ª—é—á–µ–π, 700 –¥–ª—è ~/.ssh)

### –ü—Ä–æ–±–ª–µ–º–∞: Permission denied –¥–ª—è sudo –∫–æ–º–∞–Ω–¥
**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ubuntu –≤ –≥—Ä—É–ø–ø—É sudo
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ NOPASSWD –¥–ª—è –Ω—É–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤ sudoers

### –ü—Ä–æ–±–ª–µ–º–∞: Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `/var/www/estimate-app-dev/logs/gunicorn-error.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `sudo nginx -t`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ubuntu –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å nginx –∫–æ–º–∞–Ω–¥—ã

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–ª–æ–µ
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Slack/Discord/Telegram, –¥–æ–±–∞–≤–∏–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ secrets:
- `SLACK_WEBHOOK_URL`
- `DISCORD_WEBHOOK_URL`
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_CHAT_ID`

### Rollback —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
–î–ª—è –æ—Ç–∫–∞—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π workflow —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –∫–æ–º–º–∏—Ç–∞:
```yaml
workflow_dispatch:
  inputs:
    commit_sha:
      description: 'SHA –∫–æ–º–º–∏—Ç–∞ –¥–ª—è –æ—Ç–∫–∞—Ç–∞'
      required: true
```

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–µ–ø–ª–æ–µ–º

- [ ] SSH –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –í—Å–µ secrets –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ GitHub
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ubuntu –∏–º–µ–µ—Ç –Ω—É–∂–Ω—ã–µ –ø—Ä–∞–≤–∞ sudo
- [ ] PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è dev.app.iqbs.pro –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/var/www/estimate-app-dev` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] DNS –¥–ª—è dev.app.iqbs.pro –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è dev.app.iqbs.pro –∞–∫—Ç–∏–≤–µ–Ω

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π!