# SSE Integration Test Guide

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Server-Sent Events

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–±–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω—ã:

#### Backend (Django)
```bash
cd backend
python manage.py runserver
# Server: http://127.0.0.1:8000/
```

#### Frontend (React)
```bash
cd frontend
npm run dev -- --port 5173
# Server: http://localhost:5173/
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173/
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É:
   - **–ú–µ–Ω–µ–¥–∂–µ—Ä**: `manager@example.com` / `password123`
   - **–ü—Ä–æ—Ä–∞–±**: `foreman@example.com` / `password123`
3. –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12)
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```javascript
// –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
const token = localStorage.getItem('authToken');
console.log('Token:', token);
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### –ú–µ—Ç–æ–¥ 1: –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE endpoint

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_TOKEN –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
const token = localStorage.getItem('authToken');
const sseUrl = `http://localhost:8000/api/v1/sse/events/?token=${token}`;

const eventSource = new EventSource(sseUrl);

eventSource.onopen = function(event) {
    console.log('üü¢ SSE Connection opened:', event);
};

eventSource.onmessage = function(event) {
    console.log('üì® SSE Message received:', JSON.parse(event.data));
};

eventSource.onerror = function(event) {
    console.log('üî¥ SSE Error:', event);
};

// –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
setTimeout(() => {
    eventSource.close();
    console.log('üîå SSE Connection closed');
}, 30000);
```

#### –ú–µ—Ç–æ–¥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ SSE Hook

SSE –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `useSSE` hook –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
// üîå [SSE] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫: http://localhost:8000/api/v1/sse/events/?token=...
// ‚úÖ [SSE] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

#### –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç—ã (–¥–æ–ª–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å SSE —Å–æ–±—ã—Ç–∏–µ)

1. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –ø—Ä–æ—Ä–∞–±** –≤ –æ–¥–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ/–≤–∫–ª–∞–¥–∫–µ
2. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –º–µ–Ω–µ–¥–∂–µ—Ä** –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ/–≤–∫–ª–∞–¥–∫–µ 
3. –í –±—Ä–∞—É–∑–µ—Ä–µ **–ø—Ä–æ—Ä–∞–±–∞** —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å–º–µ—Ç—É
4. –í –±—Ä–∞—É–∑–µ—Ä–µ **–º–µ–Ω–µ–¥–∂–µ—Ä–∞** –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π —Å–º–µ—Ç–µ

#### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ –æ–±—ä–µ–∫—Ç –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
const demo = new SSEDemo();
demo.startListening();

// –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ (—Å–∏–º—É–ª—è—Ü–∏—è)
SSETestUtils.createTestEstimateEvent();

// –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–∏—é —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
SSETestUtils.runTestSequence(2000); // –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã

// –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ
demo.stopListening();
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ SSE

#### –í –±—Ä–∞—É–∑–µ—Ä–µ
```bash
# GET –∑–∞–ø—Ä–æ—Å –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ (–Ω—É–∂–µ–Ω Bearer —Ç–æ–∫–µ–Ω)
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8000/api/v1/sse/stats/
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:
```json
{
  "total_users": 2,
  "total_connections": 3,
  "users": {
    "1": 2,
    "2": 1
  }
}
```

### 6. –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

#### Backend –ª–æ–≥–∏
```bash
# –°–º–æ—Ç—Ä–µ—Ç—å SSE –ª–æ–≥–∏
tail -f backend/audit.log | grep SSE

# –û–±—â–∏–µ Django –ª–æ–≥–∏
tail -f backend/server.log
```

#### Frontend –∫–æ–Ω—Å–æ–ª—å
–í—Å–µ SSE —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
- `üîå [SSE]` - —Å–æ–±—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `üì® [SSE]` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- `üöå [EventBus]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

### 7. –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

#### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:
1. ‚úÖ SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
2. ‚úÖ Keep-alive —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
3. ‚úÖ –°–æ–±—ã—Ç–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–º–µ—Ç
4. ‚úÖ React Query –∫—ç—à–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
5. ‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

**401 Unauthorized**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω

**CORS –æ—à–∏–±–∫–∏**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ Django
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ frontend –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5173

**SSE –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Django —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL endpoints –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### 8. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫ –±—Ä–∞—É–∑–µ—Ä–∞
2. –í–æ–π–¥–∏—Ç–µ –≤ –∫–∞–∂–¥—É—é –ø–æ–¥ —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
3. –í –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ —Å–æ–∑–¥–∞–π—Ç–µ —Å–º–µ—Ç—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥—Ä—É–≥–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ —Å–æ–±—ã—Ç–∏—è

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
const connection = window.sseConnection; // –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
// –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ/–∑–∞–ø—É—Å—Ç–∏—Ç–µ Django —Å–µ—Ä–≤–µ—Ä
// SSE –¥–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
```

### 9. –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
// –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
if (window.eventSource) {
    window.eventSource.close();
}

// –û—á–∏—Å—Ç–∏—Ç—å Event Bus
if (window.eventBus) {
    window.eventBus.clear();
}
```

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] Django –∏ React —Å–µ—Ä–≤–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è  
- [ ] SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- [ ] Keep-alive —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- [ ] –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–º–µ—Ç
- [ ] –°–æ–±—ã—Ç–∏—è –ø–æ–ª—É—á–∞—é—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö/–≤–∫–ª–∞–¥–∫–∞—Ö
- [ ] React Query –∫—ç—à–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- [ ] UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ SSE –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SSE —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è:
1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–º–µ—Ç –º–µ–∂–¥—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ –∏ –ø—Ä–æ—Ä–∞–±–∞–º–∏
2. ‚úÖ Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å–º–µ—Ç–∞—Ö  
3. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π Event Bus —Å–∏—Å—Ç–µ–º–æ–π