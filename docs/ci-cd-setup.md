# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CI/CD

```mermaid
graph LR
    A[Git Push] --> B[GitHub Actions]
    B --> C[Tests]
    C --> D[Build Docker]
    D --> E[Deploy to Server]
    E --> F[Health Check]
    
    G[dev branch] --> H[Quick Deploy]
    I[main branch] --> J[Full Deploy]
```

## üìã Workflows

### 1. –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (main –≤–µ—Ç–∫–∞)

**–§–∞–π–ª**: `.github/workflows/deploy-production.yml`

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` –≤–µ—Ç–∫—É
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub UI

**–≠—Ç–∞–ø—ã:**
1. **üß™ Test** - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å PostgreSQL
2. **üèóÔ∏è Build** - —Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
3. **üöÄ Deploy** - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~10-15 –º–∏–Ω—É—Ç

### 2. –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (dev –≤–µ—Ç–∫–∞)

**–§–∞–π–ª**: `.github/workflows/quick-deploy.yml`

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `dev` –≤–µ—Ç–∫—É
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–≠—Ç–∞–ø—ã:**
1. **üìã Analyze** - –∞–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **‚ö° Deploy** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥–∞

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~2-3 –º–∏–Ω—É—Ç—ã

## üîë GitHub Secrets

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------|----------|--------|
| `PRODUCTION_SSH_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á | `-----BEGIN RSA PRIVATE KEY-----...` |

### –ü–æ–ª—É—á–µ–Ω–∏–µ SSH –∫–ª—é—á–∞

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
ssh-keygen -t rsa -b 4096 -C "deploy@yourdomain.com" -f ~/.ssh/deploy_key

# –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
cat ~/.ssh/deploy_key.pub

# –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤–∏—Ç—å –≤ GitHub Secrets)
cat ~/.ssh/deploy_key
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
mkdir -p ~/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2E..." >> ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π

### Production Environment

**–§–∞–π–ª**: `deploy/production.env`

```env
# =============================================================================
# –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# =============================================================================
DATABASE_URL=postgresql://estimate_user:secure_password_123@host.docker.internal:5432/estimate_app_db
SECRET_KEY=–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û_–ò–ó–ú–ï–ù–ò–¢–ï_–ù–ê_–£–ù–ò–ö–ê–õ–¨–ù–´–ô_–ö–õ–Æ–ß_50_–°–ò–ú–í–û–õ–û–í
DEBUG=False

# =============================================================================
# –î–û–ú–ï–ù –ò –°–ï–¢–¨
# =============================================================================
ALLOWED_HOSTS=–í–ê–®–ò_IP_–ò_–î–û–ú–ï–ù–´_–ß–ï–†–ï–ó_–ó–ê–ü–Ø–¢–£–Æ
CORS_ALLOWED_ORIGINS=https://yourdomain.com,http://yourdomain.com
CSRF_TRUSTED_ORIGINS=https://yourdomain.com,http://yourdomain.com
VITE_API_BASE_URL=https://yourdomain.com/api/v1

# =============================================================================
# SSL –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
# =============================================================================
SSL_ENABLED=False  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

# =============================================================================
# EMAIL
# =============================================================================
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your_email@gmail.com
EMAIL_HOST_PASSWORD=your_app_password
DEFAULT_FROM_EMAIL=noreply@yourdomain.com

# =============================================================================
# –ë–ê–ó–ê –î–ê–ù–ù–´–•
# =============================================================================
POSTGRES_DB=estimate_app_db
POSTGRES_USER=estimate_user
POSTGRES_PASSWORD=secure_password_123
POSTGRES_PORT=5432
```

### Workflow Configuration

**–§–∞–π–ª**: `.github/workflows/deploy-production.yml`

```yaml
env:
  SERVER_HOST: 195.14.122.135     # IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
  SERVER_USER: root               # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH
  PROJECT_PATH: /var/www/estimate-app
  DOCKER_IMAGE_PREFIX: estimate-app
```

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—Ä–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏—è frontend –∫–æ–¥–∞
- –í–∞–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
git checkout main
git add .
git commit -m "feat: –≤–∞–∂–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"
git push origin main
```

### 2. –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤ –≤ backend
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Python –∫–æ–¥–µ
- –ù–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Django
- –ú–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏ API

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
git checkout dev
git add .
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞"
git push origin dev
```

### 3. –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)

```bash
# –¢–æ–ª—å–∫–æ –¥–ª—è backend –∏–∑–º–µ–Ω–µ–Ω–∏–π
./deploy/sync-code.sh

# –ò–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@SERVER_IP "cd /var/www/estimate-app && bash quick-deploy.sh"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ–µ–≤

### GitHub Actions Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É "Actions"
3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å workflows

### –°—Ç–∞—Ç—É—Å—ã –¥–µ–ø–ª–æ—è

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|----------|
| ‚úÖ **Success** | –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| ‚ùå **Failed** | –û—à–∏–±–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏, –∏—Å–ø—Ä–∞–≤–∏—Ç—å |
| üü° **Running** | –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ | –ñ–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
| ‚è∏Ô∏è **Cancelled** | –î–µ–ø–ª–æ–π –æ—Ç–º–µ–Ω–µ–Ω | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å |

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl https://yourdomain.com/api/v1/health/

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh root@SERVER_IP "docker ps"

# –õ–æ–≥–∏ –¥–µ–ø–ª–æ—è
ssh root@SERVER_IP "docker logs estimate-backend --tail 50"
```

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º CI/CD

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

#### ‚ùå "Permission denied (publickey)"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π SSH –∫–ª—é—á

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á
ssh -T git@github.com

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@SERVER_IP

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–ª—é—á
ssh-keygen -t rsa -b 4096 -C "deploy@yourdomain.com"
```

#### ‚ùå "Tests failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ
cd backend
python manage.py test

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å
git add .
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã"
git push
```

#### ‚ùå "Docker build failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∏ –≤ Dockerfile –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ
docker build -t test-backend ./backend
docker build -t test-frontend ./frontend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
cd backend && pip install -r requirements.txt
cd frontend && npm install
```

#### ‚ùå "Deployment failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
ssh root@SERVER_IP "df -h"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker
ssh root@SERVER_IP "docker system df"

# –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
ssh root@SERVER_IP "docker system prune -f"
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```yaml
# –î–æ–±–∞–≤–∏—Ç—å –≤ workflow
- name: Notify Slack
  if: always()
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ GitHub ‚Üí Settings ‚Üí Notifications

### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```yaml
- name: Telegram Notification
  if: failure()
  uses: appleboy/telegram-action@master
  with:
    to: ${{ secrets.TELEGRAM_TO }}
    token: ${{ secrets.TELEGRAM_TOKEN }}
    message: "‚ùå Deployment failed!"
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CI/CD

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```yaml
- name: Cache Docker layers
  uses: actions/cache@v3
  with:
    path: /tmp/.buildx-cache
    key: ${{ runner.os }}-buildx-${{ github.sha }}
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```yaml
strategy:
  matrix:
    service: [backend, frontend]
```

### –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```yaml
if: contains(github.event.head_commit.message, '[deploy]')
```

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ–≥–∏ –¥–ª—è —Ä–µ–ª–∏–∑–æ–≤
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0
```

### 2. –í–µ—Ç–≤–ª–µ–Ω–∏–µ

- `main` - production
- `dev` - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- `feature/*` - –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `hotfix/*` - —Å—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 3. –ö–æ–º–º–∏—Ç—ã

```bash
# –•–æ—Ä–æ—à–∏–µ –∫–æ–º–º–∏—Ç—ã
git commit -m "feat: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ API"
git commit -m "docs: –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ –º–∏–Ω–∏–º—É–º 80%
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

### 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitHub Secrets
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏

---

**–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª**: [üì¶ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](./deployment.md)