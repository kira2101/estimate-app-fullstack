# üì¶ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é production –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          Production Server                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Nginx     ‚îÇ  ‚îÇ   Docker     ‚îÇ  ‚îÇ       PostgreSQL        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (SSL)     ‚îÇ  ‚îÇ  Containers  ‚îÇ  ‚îÇ    (Host/Container)     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    :80      ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ         :5432           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   :443      ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                        ‚îÇ            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Frontend   ‚îÇ  ‚îÇ    Backend      ‚îÇ  ‚îÇ       Redis         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ (React App) ‚îÇ  ‚îÇ   (Django)      ‚îÇ  ‚îÇ     (Optional)      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   :3000     ‚îÇ  ‚îÇ     :8000       ‚îÇ  ‚îÇ       :6379         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

#### –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (main –≤–µ—Ç–∫–∞)

```bash
# –¢—Ä–∏–≥–≥–µ—Ä
git push origin main

# –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
1. üß™ Tests          # 3-5 –º–∏–Ω—É—Ç
2. üèóÔ∏è Build          # 5-8 –º–∏–Ω—É—Ç  
3. üöÄ Deploy         # 2-4 –º–∏–Ω—É—Ç—ã
4. ‚úÖ Health Check   # 1 –º–∏–Ω—É—Ç–∞
```

#### –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (dev –≤–µ—Ç–∫–∞)

```bash
# –¢—Ä–∏–≥–≥–µ—Ä
git push origin dev

# –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
1. üìã Analyze        # 30 —Å–µ–∫—É–Ω–¥
2. ‚ö° Quick Deploy   # 1-2 –º–∏–Ω—É—Ç—ã
3. ‚úÖ Health Check   # 30 —Å–µ–∫—É–Ω–¥
```

### 2. –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

#### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@195.14.122.135

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ–µ–∫—Ç
cd /var/www/estimate-app

# –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
bash deploy.sh

# –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π
bash quick-deploy.sh
```

#### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞
./deploy/sync-code.sh

# –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞
docker build -t estimate-backend ./backend
docker save estimate-backend > backend.tar
scp backend.tar root@195.14.122.135:/var/www/estimate-app/
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/var/www/estimate-app/
‚îú‚îÄ‚îÄ docker-compose.yml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ .env                        # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ backend-image.tar           # Docker –æ–±—Ä–∞–∑ backend
‚îú‚îÄ‚îÄ frontend-image.tar          # Docker –æ–±—Ä–∞–∑ frontend
‚îú‚îÄ‚îÄ deploy.sh                   # –°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ quick-deploy.sh             # –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ nginx.conf                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx (legacy)
‚îú‚îÄ‚îÄ logs/                       # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ django.log
‚îÇ   ‚îú‚îÄ‚îÄ security.log
‚îÇ   ‚îî‚îÄ‚îÄ audit.log
‚îú‚îÄ‚îÄ static/                     # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã Django
‚îú‚îÄ‚îÄ media/                      # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ ssl/                        # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (legacy)
‚îî‚îÄ‚îÄ backups/                    # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ë–î
    ‚îî‚îÄ‚îÄ db_backup_YYYYMMDD_HHMMSS.sql
```

## üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### docker-compose.production.yml

```yaml
version: '3.8'

services:
  # PostgreSQL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Ö–æ—Å—Ç–µ)
  postgres:
    image: postgres:15
    container_name: estimate-postgres
    environment:
      POSTGRES_DB: estimate_app_db
      POSTGRES_USER: estimate_user
      POSTGRES_PASSWORD: secure_password_123
    profiles:
      - new-db  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

  # Backend Django
  backend:
    image: estimate-app-backend:latest
    container_name: estimate-backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${SECRET_KEY}
      - SSL_ENABLED=${SSL_ENABLED}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - estimate_network

  # Frontend React
  frontend:
    image: estimate-app-frontend:latest
    container_name: estimate-frontend
    ports:
      - "3000:80"
    environment:
      - VITE_API_BASE_URL=${VITE_API_BASE_URL}
    networks:
      - estimate_network

networks:
  estimate_network:
    external: true  # –°–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ deploy.sh
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
docker ps -a

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker restart estimate-backend
docker restart estimate-frontend

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs -f estimate-backend
docker logs -f estimate-frontend

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it estimate-backend bash
docker exec -it estimate-frontend sh

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d
```

## üåê Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–π Nginx

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π nginx, –∞ –Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `/etc/nginx/sites-available/app.iqbs.pro.conf`

```nginx
# HTTP configuration (–±–µ–∑ SSL)
server {
    listen 80;
    server_name app.iqbs.pro;

    # Let's Encrypt challenge
    location /.well-known/acme-challenge/ {
        root /var/www/html;
    }

    # Frontend proxy
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Backend API proxy
    location /api/ {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `/etc/nginx/sites-available/app.iqbs.pro-ssl.conf`

–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
systemctl reload nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
systemctl restart nginx

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
systemctl status nginx

# –õ–æ–≥–∏
tail -f /var/log/nginx/app.iqbs.pro.access.log
tail -f /var/log/nginx/app.iqbs.pro.error.log
```

## üîê SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ

SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ø–æ–ª—É—á–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ Let's Encrypt.

### –†—É—á–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ certbot
apt install -y certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
certbot certonly --webroot -w /var/www/html -d app.iqbs.pro

# –ò–ª–∏ —á–µ—Ä–µ–∑ nginx
certbot --nginx -d app.iqbs.pro
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏

```bash
# –°–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
certbot certificates

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
certbot renew

# –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
certbot renew --dry-run

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (cron)
echo "0 12 * * * /usr/bin/certbot renew --quiet" | crontab -
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### PostgreSQL –Ω–∞ —Ö–æ—Å—Ç–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
apt install -y postgresql postgresql-contrib

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ë–î
sudo -u postgres psql
CREATE USER estimate_user WITH PASSWORD 'secure_password_123';
CREATE DATABASE estimate_app_db OWNER estimate_user;
GRANT ALL PRIVILEGES ON DATABASE estimate_app_db TO estimate_user;
\q

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
echo "DATABASE_URL=postgresql://estimate_user:secure_password_123@host.docker.internal:5432/estimate_app_db" >> /var/www/estimate-app/.env
```

### PostgreSQL –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º new-db
docker-compose --profile new-db up -d postgres

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker exec estimate-postgres pg_isready
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î

```bash
# –ú–∏–≥—Ä–∞—Ü–∏–∏
docker exec estimate-backend python manage.py migrate

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker exec -it estimate-backend python manage.py createsuperuser

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
docker exec estimate-backend python manage.py seed_db

# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
docker exec estimate-postgres pg_dump -U estimate_user estimate_app_db > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
docker exec -i estimate-postgres psql -U estimate_user estimate_app_db < backup.sql
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### Health Checks

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl https://app.iqbs.pro/api/v1/health/

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{
  "status": "healthy",
  "service": "estimate-backend",
  "version": "1.0.0"
}
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã
systemctl status nginx
systemctl status postgresql  # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
htop
df -h
```

### –õ–æ–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
# –õ–æ–≥–∏ –¥–µ–ø–ª–æ—è
journalctl -u docker -f

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker logs -f estimate-backend
docker logs -f estimate-frontend

# –õ–æ–≥–∏ nginx
tail -f /var/log/nginx/app.iqbs.pro.error.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
journalctl -f
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ä–µ–¥—ã

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª**: `/var/www/estimate-app/.env`

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SECRET_KEY=your_secret_key_here_50_characters_minimum
DEBUG=False
SSL_ENABLED=True

# –î–æ–º–µ–Ω –∏ —Å–µ—Ç—å
ALLOWED_HOSTS=195.14.122.135,localhost,app.iqbs.pro,iqbs.pro
CORS_ALLOWED_ORIGINS=https://app.iqbs.pro,http://app.iqbs.pro
CSRF_TRUSTED_ORIGINS=https://app.iqbs.pro,http://app.iqbs.pro

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://estimate_user:secure_password_123@host.docker.internal:5432/estimate_app_db

# Frontend
VITE_API_BASE_URL=https://app.iqbs.pro/api/v1

# Email
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your_email@gmail.com
EMAIL_HOST_PASSWORD=your_app_password
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ .env
nano /var/www/estimate-app/.env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker restart estimate-backend
```

## üöÄ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### Blue-Green Deployment

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ø–∏–∏
cp docker-compose.yml docker-compose.blue.yml

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ green
docker-compose -f docker-compose.green.yml up -d

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ nginx –Ω–∞ green
ln -sf /etc/nginx/sites-available/app.iqbs.pro-green.conf /etc/nginx/sites-enabled/app.iqbs.pro.conf
nginx -s reload

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ blue
docker-compose -f docker-compose.blue.yml down
```

### Rolling Update

```bash
# –ü–æ–æ—á–µ—Ä–µ–¥–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d --no-deps backend
sleep 30
docker-compose up -d --no-deps frontend
```

### Canary Deployment

```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞
# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ nginx upstream
```

## üîÑ –û—Ç–∫–∞—Ç (Rollback)

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç

```bash
# –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard HEAD~1
git push --force

# –ò–ª–∏ –æ—Ç–∫–∞—Ç –∫ —Ç–µ–≥—É
git checkout v1.0.0
git push --force
```

### –û—Ç–∫–∞—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
docker exec -i estimate-postgres psql -U estimate_user estimate_app_db < /var/www/estimate-app/backups/backup_YYYYMMDD.sql
```

### –û—Ç–∫–∞—Ç Docker –æ–±—Ä–∞–∑–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ–±—Ä–∞–∑–æ–≤
docker tag estimate-app-backend:v1.0.0 estimate-app-backend:latest
docker-compose up -d --no-deps backend
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤

```bash
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ
docker save estimate-app-backend:latest | gzip > backend.tar.gz
docker save estimate-app-frontend:latest | gzip > frontend.tar.gz

# –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤
gunzip < backend.tar.gz | docker load
gunzip < frontend.tar.gz | docker load
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
docker build -t backend ./backend &
docker build -t frontend ./frontend &
wait
```

### –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç–æ—è

```bash
# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
docker pull postgres:15 &
docker pull nginx:alpine &

# –ü—Ä–æ–≥—Ä–µ–≤ –∫–µ—à–∞
curl -s https://app.iqbs.pro/api/v1/health/ > /dev/null
```

## üö® –ê–≤–∞—Ä–∏–π–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down
systemctl stop nginx

# 2. –û—á–∏—Å—Ç–∫–∞
docker system prune -f
docker volume prune -f

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
git clone https://github.com/yourusername/estimate-app-fullstack.git /var/www/estimate-app-new
cd /var/www/estimate-app-new

# 4. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
bash deploy/deploy.sh

# 5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
docker exec -i estimate-postgres psql -U estimate_user estimate_app_db < backup.sql
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
fsck /dev/sda1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker system df
docker system events

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
netstat -tulpn
iptables -L
```

---

**–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª**: [üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º](./troubleshooting.md)